

<h1 id="chat-sessions">Chat Sessions</h1>

<p>Browse and read saved conversations from the <code class="language-plaintext highlighter-rouge">chats</code> folder.</p>

<div id="chat-app" class="chat-app">
  <div class="chat-sidebar">
    <input id="chat-search" type="search" placeholder="Filter sessions…" aria-label="Filter sessions" />
    <ul id="session-list" class="session-list"><li class="session-item" data-path="/chats/session-2025-09-27T16-55-86f0d747.json">
          <button class="session-button" title="session-2025-09-27T16-55-86f0d747.json">session-2025-09-27T16-55-86f0d747.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-24T12-54-f32fbc40.json">
          <button class="session-button" title="session-2025-09-24T12-54-f32fbc40.json">session-2025-09-24T12-54-f32fbc40.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-24T03-14-e0e4e074.json">
          <button class="session-button" title="session-2025-09-24T03-14-e0e4e074.json">session-2025-09-24T03-14-e0e4e074.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-21T23-19-831e5cdd.json">
          <button class="session-button" title="session-2025-09-21T23-19-831e5cdd.json">session-2025-09-21T23-19-831e5cdd.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-21T23-00-1ec950e4.json">
          <button class="session-button" title="session-2025-09-21T23-00-1ec950e4.json">session-2025-09-21T23-00-1ec950e4.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-20T11-26-31a95848.json">
          <button class="session-button" title="session-2025-09-20T11-26-31a95848.json">session-2025-09-20T11-26-31a95848.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-20T10-34-3fbc0a62.json">
          <button class="session-button" title="session-2025-09-20T10-34-3fbc0a62.json">session-2025-09-20T10-34-3fbc0a62.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-20T09-42-639d3457.json">
          <button class="session-button" title="session-2025-09-20T09-42-639d3457.json">session-2025-09-20T09-42-639d3457.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-18T12-21-7ff9f7fe.json">
          <button class="session-button" title="session-2025-09-18T12-21-7ff9f7fe.json">session-2025-09-18T12-21-7ff9f7fe.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-18T11-24-ff6a883c.json">
          <button class="session-button" title="session-2025-09-18T11-24-ff6a883c.json">session-2025-09-18T11-24-ff6a883c.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-18T11-20-3b59a7c1.json">
          <button class="session-button" title="session-2025-09-18T11-20-3b59a7c1.json">session-2025-09-18T11-20-3b59a7c1.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-18T06-11-01fce3bd.json">
          <button class="session-button" title="session-2025-09-18T06-11-01fce3bd.json">session-2025-09-18T06-11-01fce3bd.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-18T02-45-67271d05.json">
          <button class="session-button" title="session-2025-09-18T02-45-67271d05.json">session-2025-09-18T02-45-67271d05.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-17T15-35-60c7d742.json">
          <button class="session-button" title="session-2025-09-17T15-35-60c7d742.json">session-2025-09-17T15-35-60c7d742.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-17T06-31-c56c0598.json">
          <button class="session-button" title="session-2025-09-17T06-31-c56c0598.json">session-2025-09-17T06-31-c56c0598.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-17T05-38-31a4ee4a.json">
          <button class="session-button" title="session-2025-09-17T05-38-31a4ee4a.json">session-2025-09-17T05-38-31a4ee4a.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-17T04-47-7095810e.json">
          <button class="session-button" title="session-2025-09-17T04-47-7095810e.json">session-2025-09-17T04-47-7095810e.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-17T04-14-134780b2.json">
          <button class="session-button" title="session-2025-09-17T04-14-134780b2.json">session-2025-09-17T04-14-134780b2.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-16T12-18-e04e290e.json">
          <button class="session-button" title="session-2025-09-16T12-18-e04e290e.json">session-2025-09-16T12-18-e04e290e.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-16T11-25-88ce69f9.json">
          <button class="session-button" title="session-2025-09-16T11-25-88ce69f9.json">session-2025-09-16T11-25-88ce69f9.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-16T03-49-1de13260.json">
          <button class="session-button" title="session-2025-09-16T03-49-1de13260.json">session-2025-09-16T03-49-1de13260.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-16T02-59-e386581f.json">
          <button class="session-button" title="session-2025-09-16T02-59-e386581f.json">session-2025-09-16T02-59-e386581f.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-15T03-10-cb090fe6.json">
          <button class="session-button" title="session-2025-09-15T03-10-cb090fe6.json">session-2025-09-15T03-10-cb090fe6.json</button>
        </li><li class="session-item" data-path="/chats/session-2025-09-10T11-03-04a71cf4.json">
          <button class="session-button" title="session-2025-09-10T11-03-04a71cf4.json">session-2025-09-10T11-03-04a71cf4.json</button>
        </li></ul>
  </div>

  <div class="chat-content">
    <div id="session-meta" class="session-meta"></div>
    <div id="messages" class="messages" aria-live="polite"></div>
  </div>
</div>

<style>
.chat-app { display: grid; grid-template-columns: 320px 1fr; gap: 1rem; min-height: 70vh; }
.chat-sidebar { border-right: 1px solid var(--color-border, #e5e7eb); padding-right: 1rem; }
.chat-sidebar #chat-search { width: 100%; padding: 0.5rem; margin-bottom: 0.75rem; }
.session-list { list-style: none; margin: 0; padding: 0; max-height: calc(80vh - 3rem); overflow: auto; }
.session-item { margin: 0 0 0.25rem 0; }
.session-button { width: 100%; text-align: left; padding: 0.5rem 0.6rem; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; }
.session-button:hover { background: #f8f9fa; }
.chat-content { display: flex; flex-direction: column; gap: 0.75rem; }
.session-meta { color: #6b7280; font-size: 0.9rem; }
.messages { display: flex; flex-direction: column; gap: 0.5rem; }
.msg { padding: 0.75rem 0.9rem; border-radius: 10px; border: 1px solid #e5e7eb; background: #ffffff; }
.msg .msg-role { font-weight: 600; margin-right: 0.35rem; }
.msg.user { border-left: 4px solid #2563eb; background: #f8fbff; }
.msg.assistant { border-left: 4px solid #059669; background: #f6fdf9; }
.msg.system { border-left: 4px solid #6b7280; background: #f9fafb; }
.thoughts { margin-top: 0.35rem; padding: 0.5rem; border-left: 3px dashed #d1d5db; background: #fafafa; border-radius: 6px; color: #374151; }
.thoughts summary { cursor: pointer; font-weight: 600; }
.token-stats { color: #6b7280; font-size: 0.8rem; margin-top: 0.25rem; }
@media (max-width: 900px) { .chat-app { grid-template-columns: 1fr; } .chat-sidebar { border-right: none; border-bottom: 1px solid #e5e7eb; padding-bottom: 1rem; } }
</style>

<script>
(function() {
  const baseurl = "/systemofmind";
  const listEl = document.getElementById('session-list');
  const searchEl = document.getElementById('chat-search');
  const messagesEl = document.getElementById('messages');
  const metaEl = document.getElementById('session-meta');

  function roleFromType(t) {
    if (!t) return 'system';
    const v = String(t).toLowerCase();
    if (v === 'user') return 'user';
    if (v === 'assistant') return 'assistant';
    if (v === 'gemini' || v === 'gpt' || v === 'model') return 'assistant';
    return v;
  }

  function renderMessages(data) {
    messagesEl.innerHTML = '';
    const { sessionId, startTime, lastUpdated, messages = [] } = data || {};
    const meta = [];
    if (sessionId) meta.push(`Session: ${sessionId}`);
    if (startTime) meta.push(`Start: ${new Date(startTime).toLocaleString()}`);
    if (lastUpdated) meta.push(`Updated: ${new Date(lastUpdated).toLocaleString()}`);
    metaEl.textContent = meta.join('  •  ');

    if (!messages.length) {
      const empty = document.createElement('div');
      empty.className = 'msg system';
      empty.textContent = 'No messages in this session.';
      messagesEl.appendChild(empty);
      return;
    }

    for (const m of messages) {
      const role = roleFromType(m.type);
      const wrap = document.createElement('div');
      wrap.className = `msg ${role}`;

      const head = document.createElement('div');
      head.innerHTML = `<span class="msg-role">${role.toUpperCase()}</span>` + (m.timestamp ? `<span class="msg-time">${new Date(m.timestamp).toLocaleString()}</span>` : '');
      wrap.appendChild(head);

      const body = document.createElement('div');
      body.className = 'msg-content';
      body.textContent = (m.content ?? '').toString();
      wrap.appendChild(body);

      if (Array.isArray(m.thoughts) && m.thoughts.length) {
        const det = document.createElement('details');
        det.className = 'thoughts';
        const sum = document.createElement('summary');
        sum.textContent = `Thoughts (${m.thoughts.length})`;
        det.appendChild(sum);
        for (const t of m.thoughts) {
          const p = document.createElement('div');
          const subj = t.subject ? `• ${t.subject}: ` : '• ';
          const desc = t.description || '';
          const ts = t.timestamp ? ` [${new Date(t.timestamp).toLocaleString()}]` : '';
          p.textContent = subj + desc + ts;
          det.appendChild(p);
        }
        wrap.appendChild(det);
      }

      if (m.tokens && typeof m.tokens === 'object') {
        const ts = document.createElement('div');
        ts.className = 'token-stats';
        const entries = Object.entries(m.tokens).map(([k,v]) => `${k}: ${v}`).join('  •  ');
        ts.textContent = entries;
        wrap.appendChild(ts);
      }

      messagesEl.appendChild(wrap);
    }
  }

  async function loadSession(path) {
    messagesEl.textContent = 'Loading…';
    metaEl.textContent = '';
    try {
      const res = await fetch(baseurl + path);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      renderMessages(data);
      // Update URL hash for deep linking
      location.hash = encodeURIComponent(path);
    } catch (err) {
      messagesEl.textContent = `Failed to load session: ${err.message}`;
    }
  }

  // Click handling
  listEl.addEventListener('click', (e) => {
    const btn = e.target.closest('button.session-button');
    if (!btn) return;
    const li = btn.closest('li.session-item');
    if (!li) return;
    const path = li.dataset.path;
    loadSession(path);
  });

  // Simple client-side filter
  searchEl.addEventListener('input', () => {
    const q = searchEl.value.toLowerCase();
    for (const li of listEl.querySelectorAll('.session-item')) {
      const text = li.textContent.toLowerCase();
      li.style.display = text.includes(q) ? '' : 'none';
    }
  });

  // Deep-link support via hash
  const initial = location.hash ? decodeURIComponent(location.hash.slice(1)) : null;
  if (initial) {
    const item = Array.from(listEl.querySelectorAll('.session-item')).find(li => li.dataset.path === initial);
    if (item) loadSession(initial);
  }
})();
</script>


